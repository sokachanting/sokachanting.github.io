<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.min.js" ></script>
<script src="./js/howler-rabbit.js" ></script>
<link rel="stylesheet" href="./js/howler-rabbit.css">
<script>
    var spriteList = {
        DailyPractice: [0, 298000],
        Chanting: [298000, 10000],
        Finishing: [339000, 86000]
    };
    
    var sound2 = new Howl({
      src: ['chanting.mp3'],
      html5: true      
    });  
    
    function playspeed(){
        myspeed=document.getElementById('myrate').value;
        sound2.rate(myspeed);
        sound2.play();
    }
    
    var sound = new Howl({
      src: ['chanting.mp3'],
      html5: true,
      sprite: spriteList,
      onend: function() {
         console.log('Finished!');
         myend();
      },
      onplay: function() {
         console.log('started!');
         myplay();
      },
        
    });  
    var currentTime=0;
    var mytimer = null;
    
    function myend() {
        //alert('ended');  
        clearInterval(mytimer);
        var minutesRequired = document.getElementById('playminutes').value;
        console.log('minutesRequired :'+minutesRequired);
        var targetMillionSecond = minutesRequired*60*1000 - spriteList.Finishing[1];
        console.log('targetMillionSecond :'+targetMillionSecond);
        if (currentTime >= 298000 && currentTime < targetMillionSecond){
           soundid=sound.play('Chanting');
        } else if (currentTime > targetMillionSecond && currentTime < minutesRequired*60*1000){
          soundid=sound.play('Finishing');
        }      
    };
    
    function myplay() {
        //alert('started');
        mytimer = setInterval(myTimerFunction, 100);
    };
    
    function myTimerFunction() {
        synchronize(currentTime /1000.0);
        document.getElementById('playtime').value=currentTime;
        currentTime += 100;
    }
      
/*
    var currentTime=0;
    var soundid = null;
    function myTimer() {
      currentTime += 100;
      
      synchronize(currentTime /1000.0);
      document.getElementById('playtime').value=sound.seek(soundid);
      if (currentTime == 100) {
         soundid=sound.play('DailyPractice');
      }
      
      if (currentTime < 300100) return;
      if (currentTime > 300100 && currentTime < 600100){
          soundid=sound.play('Chanting');
      }
      if (currentTime == 600100){
          soundid=sound.play('Finishing');
      }
    }
*/
    function playchanting() {
        
        var start = document.getElementById('start').value;
        var duration = document.getElementById('duration').value;
        alert ("start: "+ start+" duration:"+duration);
        sound.sprite = {
            Split: [start, duration]
        }
        
        sound.play('Split');
        alert ("played");
    }
    
    function playTime(){
        currentTime = 0;
        alert ('testing: ' + spriteList.DailyPractice[1]);
        //alert('duration: '+sound.duration('DailyPractice')+' '+sound.duration('Chanting') + ' ' + sound.duration('Finishing') +' end');
//        var myVar = setInterval(myTimer, 100);
        //var inTime = document.getElementById('playminutes').value;
        //var nTime = (inTime*60 - 386)/10;
        //sound.play('DailyPractice');
        //for (i=0; i< nTime; i++){
        //    sound.play('Chanting');
        //}
        //sound.play('Finishing');
    }
</script>
</head>
<body>
<!-- 
<button name=play value=play onclick="document.getElementById('audio-1').play()" > Play </button>
--> 
   
    <input name="start" type="text" id="start"></input>    
    </br>
    <input name="duration" type="text" id="duration"> </input>  
    <br>
    <button name=play1 value=play1 onclick="playchanting()" > Play chanting</button>

</br></br></br></br>
version 21
</br>

    <input name="playminutes" type="text" id="playminutes" value="10"></input>  
    <br>
    <button name=playminutes value=playminutes onclick="playTime()" > Play by time</button>
    <br/>
     <input name="playtime" type="text" id="playtime"></input>    
</br></br></br></br></br>
    
<button name=play1 value=play1 onclick="sound.play('DailyPractice')" > Play DailyPractice</button>
<button name=play2 value=play2 onclick="sound.play('Chanting')" > Play Chanting</button>
<button name=play3 value=play3 onclick="sound.play('Finishing')" > Play Finishing</button>   

 </br></br></br></br></br>

  <input name="myrate" type="text" id="myrate" value="0.5"></input>  
    <br>
    <button name=playmyrate value=playmyrate onclick="playspeed()" > Play by speed</button>
    <br/>

    
<!-- <div class="lyrics-1"> -->
    
<div id="rabbit-lyrics" class="rabbit-lyrics" data-audio="#audio-1">
[00:01.00] 01 sec
 new line
[00:02.00] 02 sec 
    new line   
[00:03.00] 03 sec 
    new line
[00:04.00] 04 sec 
    new line
[00:05.00] 05 sec 
    new line 
[00:06.00] 06 sec 
    new line
[00:07.00] 07 sec 
    new line    
[00:08.00] 08 sec
    new line
[00:09.00] 09 sec 
    new line
[00:10.00] 10 sec
    new line
[00:11.00] 11 sec 
    new line
[00:12.00] 12 sec 
    new line   
[00:13.00] 13 sec 
    new line
[00:14.00] 14 sec 
    new line
[00:15.00] 15 sec 
    new line
[00:16.00] 16 sec 
    new line
[00:17.00] 17 sec 
    new line   
[00:18.00] 18 sec 
    new line
[00:19.00] 19 sec 
    new line
[00:20.00] 20 sec 
    new line 
</div>
    
<script> 
parseLyrics(document.getElementById('rabbit-lyrics'));
    
synchronize(5.1);
</script>
</body>
</html>
